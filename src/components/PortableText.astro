---
import { toHTML } from '@portabletext/to-html'

const { value } = Astro.props

const components = {
  types: {
    spacer: ({ value }) => {
      const size = value?.size || 'md'
      return `<div class="hc-spacer hc-spacer--${size}" aria-hidden="true"></div>`
    },
  },
  marks: {
    highlight: ({ children }) => `<mark class="hc-highlight">${children}</mark>`,
    link: ({ children, value }) => {
      const href = value?.href || '#'
      const blank = value?.blank !== false
      const target = blank ? ' target="_blank"' : ''
      const rel = blank ? ' rel="noopener noreferrer"' : ''
      return `<a href="${href}"${target}${rel}>${children}</a>`
    },
  },
}

const html = value ? toHTML(value, { components }) : ''
---

{html ? <div class="portabletext" set:html={html} /> : null}

<style>
  /* Enter = פסקה חדשה, אבל עם רווח קטן */
  .portabletext :global(p) {
    margin: 0;
    line-height: 1.85;
  }

  /* רק בין פסקאות יש רווח קטן */
  .portabletext :global(p + p) {
    margin-top: 0.55rem;
  }

  .portabletext :global(h2) {
    margin: 1.4rem 0 0.6rem;
    line-height: 1.2;
    font-weight: 900;
  }

  .portabletext :global(h3) {
    margin: 1.2rem 0 0.55rem;
    line-height: 1.25;
    font-weight: 900;
  }

  .portabletext :global(blockquote) {
    margin: 1rem 0;
    padding: 0.75rem 1rem;
    border-right: 3px solid rgba(41, 81, 87, 0.35);
    background: rgba(41, 81, 87, 0.06);
    border-radius: 14px;
  }

  .portabletext :global(ul) {
    margin: 0.8rem 0;
    padding-right: 1.25rem;
  }

  .portabletext :global(li) {
    margin: 0.35rem 0;
    line-height: 1.8;
  }

  .portabletext :global(mark.hc-highlight) {
    background: rgba(243, 193, 74, 0.22);
    padding: 0 0.2em;
    border-radius: 0.35em;
  }

  .portabletext :global(a) {
    text-decoration: underline;
    text-underline-offset: 3px;
  }

  /* רווחים גדולים בכוונה (לא ע"י Enter כפול) */
  .portabletext :global(.hc-spacer) {
    width: 100%;
  }
  .portabletext :global(.hc-spacer--sm) { height: 0.6rem; }
  .portabletext :global(.hc-spacer--md) { height: 1.2rem; }
  .portabletext :global(.hc-spacer--lg) { height: 2rem; }
</style>
