---
import BaseLayout from '../layouts/BaseLayout.astro'
import PortableText from '../components/PortableText.astro'

import { sanity } from '../lib/sanity'

// שאילתה לדף הבית (Singleton)
const query = `
*[_type == "homePage"][0]{
  seo,
  hero{
    badge,
    titleLine1,
    titleLine2,
    titleLine3,
    subheadline,
    description,
    primaryCtaLabel,
    primaryCtaHref
  },
  h1Title,
  bridgeText,
  cardGrid,
  methodSection,
  faq,
  bottomCta
}
`

const home = await sanity.fetch(query)

if (!home) {
  throw new Error('HomePage document not found in Sanity')
}
---

<BaseLayout
  title={home.seo?.title}
  description={home.seo?.description}
  canonical={home.seo?.canonical}
  noindex={home.seo?.noindex}
  ogImage={home.seo?.ogImageUrl}
>

  <!-- HERO (לא H1) -->
  <section class="relative overflow-hidden">
    <div class="container mx-auto px-6 py-24 text-center">

      {home.hero?.badge && (
        <span class="inline-block mb-6 text-sm font-display tracking-wide text-accent">
          {home.hero.badge}
        </span>
      )}

      <div class="font-display text-4xl md:text-6xl leading-tight text-foreground">
        <div>{home.hero.titleLine1}</div>
        <div>{home.hero.titleLine2}</div>
        <div>{home.hero.titleLine3}</div>
      </div>

      {home.hero?.subheadline && (
        <p class="mt-6 text-xl font-body text-muted-foreground">
          {home.hero.subheadline}
        </p>
      )}

      {home.hero?.description && (
        <p class="mt-4 max-w-2xl mx-auto font-body text-muted-foreground">
          {home.hero.description}
        </p>
      )}

      {home.hero?.primaryCtaLabel && home.hero?.primaryCtaHref && (
        <div class="mt-10">
          <a
            href={home.hero.primaryCtaHref}
            class="inline-block rounded-xl bg-accent px-8 py-4 font-display text-white hover:opacity-90 transition"
          >
            {home.hero.primaryCtaLabel}
          </a>
        </div>
      )}
    </div>
  </section>

  <!-- H1 אמיתי -->
  <section class="container mx-auto px-6 mt-24">
    <h1 class="font-display text-3xl md:text-4xl text-foreground">
      {home.h1Title}
    </h1>

    <p class="mt-4 max-w-2xl font-body text-muted-foreground">
      {home.bridgeText}
    </p>
  </section>

  <!-- CARD GRID -->
  {home.cardGrid && (
    <section class="container mx-auto px-6 mt-20">
      <PortableText value={home.cardGrid} />
    </section>
  )}

  <!-- METHOD SECTION -->
  {home.methodSection && (
    <section class="container mx-auto px-6 mt-24">
      <PortableText value={home.methodSection} />
    </section>
  )}

  <!-- FAQ -->
  {home.faq && (
    <section class="container mx-auto px-6 mt-24">
      <PortableText value={home.faq} />
    </section>
  )}

  <!-- CTA תחתון -->
  {home.bottomCta?.label && home.bottomCta?.href && (
    <section class="container mx-auto px-6 mt-24 mb-32 text-center">
      <a
        href={home.bottomCta.href}
        class="inline-block rounded-xl bg-accent px-10 py-5 font-display text-white hover:opacity-90 transition"
      >
        {home.bottomCta.label}
      </a>
    </section>
  )}

</BaseLayout>
